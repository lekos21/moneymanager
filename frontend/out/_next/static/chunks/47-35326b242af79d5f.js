"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[47],{47:function(e,t,a){a.d(t,{ZP:function(){return S},jK:function(){return _}});var s=a(5893),r=a(7294),n=a(1352),o=a(3742),l=a(2448),i=a(3718),c=a(1526),d=a(3495),x=a(4622),u=a(7764),g=a(8086),m=a(3071);function p(e){let{selectedAreaTags:t=[],selectedContextTags:a=[],onTagsChange:n,showAllTags:o=!1}=e,{tags:l}=(0,g.e0)(),[i,c]=(0,r.useState)(""),[d,x]=(0,r.useState)("area"),m=(0,r.useMemo)(()=>{if(!l||0===l.length)return[];let e=i.toLowerCase();return l.filter(t=>{var a,s,r;return(null===(a=t.tag_id)||void 0===a?void 0:a.toLowerCase().includes(e))||(null===(s=t.label)||void 0===s?void 0:s.toLowerCase().includes(e))||(null===(r=t.synonyms)||void 0===r?void 0:r.some(t=>t.toLowerCase().includes(e)))})},[l,i]),p=(0,r.useMemo)(()=>o?m:m.filter(e=>e.facet===d),[m,o,d]),y=e=>{if("area"===e.facet){let s=t.includes(e.tag_id)?t.filter(t=>t!==e.tag_id):[...t,e.tag_id];n({area_tags:s,context_tags:a})}else{let s=a.includes(e.tag_id)?a.filter(t=>t!==e.tag_id):[...a,e.tag_id];n({area_tags:t,context_tags:s})}};return(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)(u.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400"}),(0,s.jsx)("input",{type:"text",value:i,onChange:e=>c(e.target.value),placeholder:"Search tags...",className:"w-full pl-10 pr-4 py-2 border border-gray-200  rounded-lg focus:outline-none focus:ring-2  focus:ring-purple-500 focus:border-transparent transition-all duration-200"})]}),!o&&(0,s.jsxs)("div",{className:"flex gap-2 p-1 bg-gray-100 rounded-lg",children:[(0,s.jsx)("button",{onClick:()=>x("area"),className:"flex-1 py-2 px-4 rounded-md font-medium transition-all\n                      ".concat("area"===d?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:"Categories"}),(0,s.jsx)("button",{onClick:()=>x("context"),className:"flex-1 py-2 px-4 rounded-md font-medium transition-all\n                      ".concat("context"===d?"bg-white text-purple-600 shadow-sm":"text-gray-600 hover:text-gray-800"),children:"Context"})]}),(t.length>0||a.length>0)&&(0,s.jsxs)("div",{className:"p-3 bg-purple-50 rounded-lg",children:[(0,s.jsx)("p",{className:"text-xs text-purple-600 font-medium mb-2",children:"Selected Tags"}),(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[t.map(e=>{let t=l.find(t=>t.tag_id===e);return t&&(0,s.jsx)(f,{tag:t,onRemove:()=>y(t)},e)}),a.map(e=>{let t=l.find(t=>t.tag_id===e);return t&&(0,s.jsx)(f,{tag:t,onRemove:()=>y(t)},e)})]})]}),(0,s.jsx)("div",{className:"max-h-64 overflow-y-auto rounded-lg border border-gray-200",children:(0,s.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-3 gap-2 p-3",children:[p.map(e=>(0,s.jsx)(h,{tag:e,isSelected:"area"===e.facet?t.includes(e.tag_id):a.includes(e.tag_id),onClick:()=>y(e)},e.tag_id)),0===p.length&&(0,s.jsx)("div",{className:"col-span-2 sm:col-span-3 py-8 text-center text-gray-500",children:i?'No tags found for "'.concat(i,'"'):"No tags available"})]})})]})}function h(e){var t,a,r;let{tag:n,isSelected:o,onClick:l}=e,i=(null===(t=n.colors)||void 0===t?void 0:t.bgHex)||"#f3f4f6",c=(null===(a=n.colors)||void 0===a?void 0:a.textHex)||"#374151";return(0,s.jsxs)("button",{onClick:l,className:"flex items-center gap-2 p-2 rounded-lg \n                  border-2 transition-all duration-200\n                  ".concat(o?"border-purple-500 bg-purple-50":"border-gray-200 hover:border-gray-300 bg-white"),children:[(0,s.jsx)("div",{className:"w-6 h-6 rounded-full flex items-center justify-center",style:{backgroundColor:i},children:(0,s.jsx)(m.Z,{iconName:n.icon||"tag",iconColor:(null===(r=n.colors)||void 0===r?void 0:r.hex)||"#6b7280",size:"sm"})}),(0,s.jsx)("span",{className:"text-sm font-medium truncate",style:{color:o?"var(--color-purple-600)":c},children:n.label||n.tag_id})]})}function f(e){var t,a;let{tag:r,onRemove:o}=e,l=(null===(t=r.colors)||void 0===t?void 0:t.bgHex)||"#f3f4f6";return(0,s.jsxs)("div",{className:"inline-flex items-center gap-1.5 px-3 py-1.5  rounded-full text-sm font-medium",style:{backgroundColor:l,color:"#333"},children:[(0,s.jsx)(m.Z,{iconName:r.icon||"tag",iconColor:(null===(a=r.colors)||void 0===a?void 0:a.hex)||"#6b7280",size:"xs"}),(0,s.jsx)("span",{children:r.label||r.tag_id}),(0,s.jsx)("button",{onClick:o,className:"ml-1 hover:opacity-70 transition-opacity","aria-label":"Remove ".concat(r.label||r.tag_id," tag"),children:(0,s.jsx)(n.Z,{className:"w-3 h-3"})})]})}var y=a(4682),v=a(4671),b=a(4856);function j(e){let{expense:t,isOpen:a,onClose:o}=e,{mutate:l}=(0,v.t)(),[i,u]=(0,r.useState)(!1),[g,m]=(0,r.useState)({amount:0,currency:"USD",short_text:"",raw_text:"",area_tags:[],context_tags:[],timestamp:new Date().toISOString()});(0,r.useEffect)(()=>{t&&m({amount:t.amount||0,currency:t.currency||"USD",short_text:t.short_text||"",raw_text:t.raw_text||"",area_tags:t.area_tags||[],context_tags:t.context_tags||[],timestamp:t.timestamp||new Date().toISOString()})},[t]);let h=e=>{let{name:t,value:a}=e.target;m(e=>({...e,[t]:a}))},f=async()=>{if(null==t?void 0:t.id){u(!0);try{await y.Z.updateExpense(t.id,g),l(),o()}catch(e){console.error("Failed to update expense:",e)}finally{u(!1)}}};return(0,s.jsx)(c.M,{children:a&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(d.E.div,{className:"fixed inset-0 bg-black/50 z-[var(--z-index-modal-backdrop)]",variants:{hidden:{opacity:0,backdropFilter:"blur(0px)"},visible:{opacity:1,backdropFilter:"blur(8px)"}},initial:"hidden",animate:"visible",exit:"hidden",onClick:o}),(0,s.jsxs)(d.E.div,{className:"fixed top-[8%] left-[4%] -translate-x-1/2 max-w-md w-[92%] max-h-[80vh] md:max-h-[80vh] bg-white rounded-2xl shadow-2xl  z-[var(--z-index-modal)]  flex flex-col overflow-hidden",variants:{hidden:{opacity:0,scale:.95,y:20},visible:{opacity:1,scale:1,y:0,transition:{type:"spring",damping:25,stiffness:300}},exit:{opacity:0,scale:.95,y:20,transition:{duration:.2}}},initial:"hidden",animate:"visible",exit:"exit",children:[(0,s.jsxs)("div",{className:"bg-gradient-to-r from-[#00e4ff] to-[#4d9fff] text-white px-4 py-3 flex items-center justify-between",children:[(0,s.jsx)("h2",{className:"text-xl font-semibold",children:"Edit Expense"}),(0,s.jsx)("button",{onClick:o,className:"w-8 h-8 rounded-full flex items-center justify-center hover:bg-white/20 transition-colors","aria-label":"Close dialog",children:(0,s.jsx)(n.Z,{className:"w-5 h-5"})})]}),(0,s.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,s.jsxs)("div",{className:"flex items-start gap-2",children:[(0,s.jsxs)("div",{className:"flex-1 space-y-1",children:[(0,s.jsx)("label",{htmlFor:"amount",className:"text-sm font-medium text-gray-700",children:"Amount"}),(0,s.jsxs)("div",{className:"relative",children:[(0,s.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-lg font-semibold text-gray-500",children:(0,b.jK)(g.currency)}),(0,s.jsx)("input",{type:"number",id:"amount",name:"amount",value:g.amount,onChange:e=>{let t=parseFloat(e.target.value)||0;m(e=>({...e,amount:t}))},step:"0.01",min:"0",placeholder:"0.00",className:"flex-1 px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4d9fff]  focus:border-transparent transition-all duration-200 text-gray-900 placeholder-gray-400 text-right"})]})]}),(0,s.jsxs)("div",{className:"w-2/5 space-y-1",children:[(0,s.jsx)("label",{htmlFor:"currency",className:"text-sm font-medium text-gray-700",children:"Currency"}),(0,s.jsxs)("select",{id:"currency",name:"currency",value:g.currency,onChange:h,className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4d9fff]  focus:border-transparent transition-all duration-200 text-gray-900",children:[(0,s.jsx)("option",{value:"USD",children:"USD"}),(0,s.jsx)("option",{value:"EUR",children:"EUR"}),(0,s.jsx)("option",{value:"GBP",children:"GBP"}),(0,s.jsx)("option",{value:"JPY",children:"JPY"}),(0,s.jsx)("option",{value:"CAD",children:"CAD"})]})]})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{htmlFor:"short_text",className:"text-sm font-medium text-gray-700",children:"Quick Description"}),(0,s.jsx)("input",{type:"text",id:"short_text",name:"short_text",value:g.short_text,onChange:h,placeholder:"e.g., Coffee at Starbucks",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4d9fff]  focus:border-transparent transition-all duration-200 text-gray-900 placeholder-gray-400"})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{htmlFor:"raw_text",className:"text-sm font-medium text-gray-700",children:"Full Details (Optional)"}),(0,s.jsx)("textarea",{id:"raw_text",name:"raw_text",value:g.raw_text,onChange:h,placeholder:"Add any additional notes...",className:"w-full px-3 py-2 border border-gray-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-[#4d9fff]  focus:border-transparent transition-all duration-200 text-gray-900 placeholder-gray-400 resize-none",rows:3})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{className:"text-sm font-medium text-gray-700",children:"Categories & Tags"}),(0,s.jsx)(p,{selectedAreaTags:g.area_tags,selectedContextTags:g.context_tags,onTagsChange:e=>{let{area_tags:t,context_tags:a}=e;m(e=>({...e,area_tags:t,context_tags:a}))},showAllTags:!0})]}),(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsx)("label",{htmlFor:"timestamp",className:"text-sm font-medium text-gray-700",children:"Date & Time"}),(0,s.jsxs)("div",{className:"flex items-center gap-2 px-3 py-2 border border-gray-200 rounded-lg",children:[(0,s.jsx)(x.Z,{className:"w-5 h-5 text-gray-500"}),(0,s.jsx)("input",{type:"datetime-local",id:"timestamp",name:"timestamp",value:g.timestamp.slice(0,16),onChange:h,className:"flex-1 focus:outline-none"})]})]})]}),(0,s.jsxs)("div",{className:"border-t border-gray-200 px-4 py-3 flex justify-end gap-3",children:[(0,s.jsx)("button",{onClick:o,className:"px-4 py-2 rounded-lg border border-gray-300 text-gray-700 font-medium hover:bg-gray-50 transition-colors duration-200",children:"Cancel"}),(0,s.jsx)("button",{onClick:f,disabled:i,className:"px-4 py-2 rounded-lg bg-gradient-to-r from-[#d233e9] to-[#4d9fff] text-white\n                          font-medium hover:from-[#d233e9]/90 hover:to-[#4d9fff]/90 transition-all\n                          duration-200 flex items-center gap-2\n                          ".concat(i?"opacity-70 cursor-not-allowed":""),children:i?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"animate-spin h-4 w-4 border-2 border-white border-t-transparent rounded-full"}),"Saving..."]}):"Save Changes"})]})]})]})})}var N=a(9108),w=a(799);let C={USD:"$",EUR:"€",GBP:"\xa3",JPY:"\xa5",CAD:"C$",AUD:"A$",CHF:"Fr",CNY:"\xa5",INR:"₹",BRL:"R$"},_=e=>C[e]||e,k=(0,r.memo)(e=>{let{expense:t,messageId:a,onDelete:c,onEdit:d,fullWidth:x=!1}=e,[u,g]=(0,r.useState)(!1),[p,h]=(0,r.useState)(!1),{tag:f,iconName:v,iconColor:b,bgColor:C,textColor:k,borderColor:S}=(0,w.u)(t),F=async()=>{if(!t.id){console.error("No expense ID found:",t);return}let e=!1;try{await y.Z.deleteExpense(t.id),e=!0}catch(e){console.warn("Expense deletion skipped or failed:",e)}if(a)try{await N.Z.deleteMessage(a)}catch(e){console.error("Failed to delete message:",e),alert("Failed to delete message. Please try again."),g(!1);return}c(e?t.id:null,a),g(!1)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"card ".concat(x?"w-full":"w-full min-w-[320px] max-w-[400px]"," border-2 border-l-4 cursor-pointer hover:shadow-md transition-shadow"),style:{borderLeftColor:S},onClick:e=>{!e.target.closest("button")&&(h(!0),d&&d(t))},children:[(0,s.jsxs)("div",{className:"card-header flex justify-between items-center py-2 px-3 gap-2",children:[(0,s.jsxs)("div",{className:"flex items-center",children:[(0,s.jsx)("div",{className:"w-7 h-7 rounded-full flex items-center justify-center mr-2",children:(0,s.jsx)(m.Z,{iconName:v,iconColor:b,className:"text-gray-700",fallbackIcon:"tag"})}),(0,s.jsxs)("div",{className:"min-w-0 flex-1 max-w-[200px]",children:[(0,s.jsx)("h4",{className:"text-base font-semibold text-gray-800 truncate overflow-hidden text-ellipsis",title:t.short_text||"Expense",children:t.short_text||"Expense"}),(0,s.jsxs)("span",{className:"flex items-center text-xs text-gray-500 space-x-1",children:[(0,s.jsx)("span",{children:new Date(t.timestamp).toLocaleDateString(void 0,{month:"short",day:"numeric"})}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{children:new Date(t.timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})})]})]})]}),(0,s.jsxs)("div",{className:"font-bold whitespace-nowrap flex-shrink-0",children:[_(t.currency),parseFloat(t.amount).toFixed(2)]})]}),(0,s.jsxs)("div",{className:"card-body px-3 py-2 flex justify-between items-center",children:[(0,s.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[t.area_tags&&t.area_tags.map(e=>(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-semibold",style:{backgroundColor:C||"#EBF5FF",color:k||"#3B82F6"},children:e},"area-".concat(e))),t.context_tags&&t.context_tags.map(e=>(0,s.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-semibold",style:{backgroundColor:C?"".concat(C,"80"):"#F0F7FF",color:k||"#2563EB"},children:e},"context-".concat(e)))]}),u?(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),g(!1)},className:"p-1 text-xs text-gray-600 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:(0,s.jsx)(n.Z,{className:"w-3 h-3"})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),F()},className:"p-1 text-xs text-white rounded-full hover:opacity-90 transition-opacity bg-gradient-secondary",children:(0,s.jsx)(o.Z,{className:"w-3 h-3"})})]}):(0,s.jsxs)("div",{className:"flex space-x-1",children:[(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),h(!0)},className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Edit expense",children:(0,s.jsx)(l.Z,{className:"w-4 h-4"})}),(0,s.jsx)("button",{onClick:e=>{e.stopPropagation(),g(!0)},className:"text-gray-400 hover:text-gray-600 transition-colors p-1","aria-label":"Delete expense",children:(0,s.jsx)(i.Z,{className:"w-4 h-4"})})]})]})]}),(0,s.jsx)(j,{expense:t,isOpen:p,onClose:()=>h(!1)})]})});var S=k},3071:function(e,t,a){var s=a(5893),r=a(7294),n=a(2062);t.Z=r.memo(e=>{let{iconName:t,iconColor:a,size:r=24,className:o="",fallbackIcon:l="tag",style:i={}}=e,c={color:a,...i};return(0,s.jsx)(n.Z,{iconName:t||l,size:r,className:o,defaultIcon:l,style:c})},(e,t)=>e.iconName===t.iconName&&e.iconColor===t.iconColor&&e.size===t.size&&e.className===t.className&&e.fallbackIcon===t.fallbackIcon&&JSON.stringify(e.style)===JSON.stringify(t.style))},799:function(e,t,a){a.d(t,{e:function(){return n},u:function(){return o}});var s=a(7294),r=a(8086);function n(){let e=(0,r.e0)();return{...e,resolveTag:t=>{if(!t)return null;let{getTag:a}=e;return t.tag_id?a(t.tag_id):t.area_tags&&t.area_tags.length>0?a(t.area_tags[0].toLowerCase()):t.tag?t.tag:null},getTagStyling:t=>{var a,s,r,n;let{getTag:o}=e,l="string"==typeof t?o(t):t;return l?{iconName:l.icon||"tag",iconColor:(null===(a=l.colors)||void 0===a?void 0:a.hex)||"#6b7280",bgColor:(null===(s=l.colors)||void 0===s?void 0:s.bgHex)||"#f3f4f6",textColor:(null===(r=l.colors)||void 0===r?void 0:r.textHex)||"#4b5563",borderColor:(null===(n=l.colors)||void 0===n?void 0:n.hex)||"#d1d5db"}:{iconName:"tag",iconColor:"#6b7280",bgColor:"#f3f4f6",textColor:"#4b5563",borderColor:"#d1d5db"}}}}function o(e){var t;let{resolveTag:a,getTagStyling:r}=n();return(0,s.useMemo)(()=>{let t=a(e),s=r(t);return{tag:t,...s}},[null==e?void 0:e.tag_id,null==e?void 0:null===(t=e.area_tags)||void 0===t?void 0:t.join(","),null==e?void 0:e.tag,a,r])}},9108:function(e,t,a){var s=a(7066),r=a(8346);let n="https://moneymanager-backend-qwbwl7ldoa-oa.a.run.app";console.log("Using API URL:",n);let o=async()=>{let e=(0,r.v0)(),t=e.currentUser;if(t)return await t.getIdToken();let a=localStorage.getItem("token");return a||new Promise((t,a)=>{let s;let r=e.onAuthStateChanged(e=>{s&&clearTimeout(s),r(),e?e.getIdToken().then(t).catch(a):a(Error("User not authenticated"))});s=setTimeout(()=>{r(),a(Error("User not authenticated"))},5e3)})},l=async()=>{let e=await o();return s.Z.create({baseURL:n,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})};t.Z={getAuthToken:o,async getMessages(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let t=await l(),a="/api/chat/messages?limit=".concat(e);console.log("Fetching messages from:",a);let s=await t.get(a);return console.log("Messages fetched successfully"),s.data}catch(e){var t;return console.error("Error fetching messages:",e),console.error("Response details:",null===(t=e.response)||void 0===t?void 0:t.data),console.log("Returning fallback messages"),[{id:"fallback-1",content:"Welcome to Money Manager! The message service is currently experiencing issues. Your previous messages will appear when service is restored.",user_id:"system",timestamp:new Date().toISOString(),message_type:"system"}]}},async sendMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user",a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{let s=await l(),r=await s.post("/api/chat/messages",{content:e,message_type:t,expense_data:a});return r.data}catch(e){throw console.error("Error sending message:",e),e}},async deleteMessage(e){try{let t=await l();return await t.delete("/api/chat/messages/".concat(e)),!0}catch(e){throw console.error("Error deleting message:",e),e}},async parseExpense(e){try{let t=await l();console.log("Sending expense parser request:",{text:e,save_to_db:!0});let a=await t.post("/api/agents/expense_parser/",{text:e,save_to_db:!0});return console.log("Expense parser response:",a.data),a.data}catch(e){var t;throw console.error("Error parsing expense:",e),console.error("Error details:",null===(t=e.response)||void 0===t?void 0:t.data),e}}}},4856:function(e,t,a){a.d(t,{jK:function(){return r}});let s={USD:"$",EUR:"€",GBP:"\xa3",JPY:"\xa5",CAD:"CA$",AUD:"A$",CHF:"CHF",CNY:"\xa5",INR:"₹"},r=e=>s[e]||e||""}}]);