(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[276],{484:function(e,s,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/history",function(){return a(9539)}])},6909:function(e,s,a){"use strict";var t=a(5893);a(7294);var l=a(7537);s.Z=e=>{let{children:s,pageName:a="this page"}=e;return(0,t.jsx)(l.Z,{fallback:(e,s)=>(0,t.jsx)("div",{className:"min-h-[70vh] flex flex-col items-center justify-center p-6 text-center",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-md p-8 max-w-md w-full",children:[(0,t.jsx)("h2",{className:"text-2xl font-semibold text-gray-800 mb-4",children:"Something went wrong"}),(0,t.jsxs)("p",{className:"text-gray-600 mb-6",children:["We're sorry, but an error occurred while loading ",a,". This could be due to a temporary issue or a problem with your connection."]}),(0,t.jsxs)("div",{className:"flex flex-col space-y-3",children:[(0,t.jsx)("button",{onClick:s,className:"btn-primary",children:"Try Again"}),(0,t.jsx)("button",{onClick:()=>window.location.href="/home",className:"btn-secondary",children:"Go to Home"})]}),!1]})}),children:s})}},5151:function(e,s,a){"use strict";var t=a(5893);a(7294),s.Z=e=>{let{className:s="",height:a="h-24",hasHeader:l=!0,hasFooter:r=!1}=e;return(0,t.jsxs)("div",{className:"animate-pulse bg-white rounded-xl shadow-md overflow-hidden ".concat(a," ").concat(s),children:[l&&(0,t.jsxs)("div",{className:"h-10 bg-gray-100 px-3 py-2 flex items-center",children:[(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-gray-200 mr-3"}),(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-3/5 mb-2"}),(0,t.jsx)("div",{className:"h-2 bg-gray-200 rounded w-2/5"})]}),(0,t.jsx)("div",{className:"w-16 h-4 bg-gray-200 rounded"})]}),(0,t.jsxs)("div",{className:"p-3 flex-1 flex flex-col justify-between",children:[(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-full"}),(0,t.jsx)("div",{className:"h-3 bg-gray-200 rounded w-4/5"})]}),r&&(0,t.jsxs)("div",{className:"flex mt-3 pt-2 border-t border-gray-100",children:[(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-16 mr-2"}),(0,t.jsx)("div",{className:"h-5 bg-gray-200 rounded w-16"})]})]})]})}},9539:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return v}});var t=a(5893),l=a(7294),r=a(1526),n=a(3495),i=a(9008),c=a.n(i);a(1664);var o=a(5493),d=a(2537),x=a(799),u=a(558),h=a(47),m=a(6909),g=a(5151),f=a(4671);function v(){return(0,t.jsx)(m.Z,{pageName:"expense history",children:(0,t.jsx)(j,{})})}function j(){let{user:e}=(0,d.a)(),{getTag:s}=(0,x.e)(),[a,i]=(0,l.useState)({areaTags:[],contextTags:[]}),[m,v]=(0,l.useState)(null),{expenses:j,isLoading:p,isError:y,mutate:b}=(0,f.t)(),N=(0,l.useMemo)(()=>{let e=new Set,s=new Set;return j.forEach(a=>{Array.isArray(a.area_tags)&&a.area_tags.forEach(s=>e.add(s)),Array.isArray(a.context_tags)&&a.context_tags.forEach(e=>s.add(e))}),{areaTags:[...e],contextTags:[...s]}},[j]);(0,l.useMemo)(()=>j.reduce((e,s)=>e+parseFloat(s.amount||0),0),[j]);let w=(0,l.useMemo)(()=>a.areaTags.length||a.contextTags.length?j.filter(e=>{let s=!a.areaTags.length||e.area_tags&&a.areaTags.some(s=>e.area_tags.includes(s)),t=!a.contextTags.length||e.context_tags&&a.contextTags.some(s=>e.context_tags.includes(s));return s&&t}):j,[j,a.areaTags,a.contextTags]),T=(e,s)=>{i(a=>{let t=[...a[s]],l=t.indexOf(e);return -1===l?t.push(e):t.splice(l,1),{...a,[s]:t}})},_=e=>{b(j.filter(s=>s.id!==e),!1),v({type:"success",message:"Expense deleted successfully"})};return(0,l.useEffect)(()=>{if(m){let e=setTimeout(()=>{v(null)},3e3);return()=>clearTimeout(e)}},[m]),(0,t.jsx)(u.i,{children:(0,t.jsxs)(o.Z,{children:[(0,t.jsx)(c(),{children:(0,t.jsx)("title",{children:"Expense History | Piggy"})}),(0,t.jsxs)("div",{className:"h-[calc(100vh-64px)] flex flex-col bg-white",children:[(0,t.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,t.jsx)("div",{className:"flex justify-between items-center",children:(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Expense History"})}),(0,t.jsxs)("div",{className:"space-y-2 mt-4",children:[N.areaTags.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Area Tags"}),(0,t.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,t.jsx)("div",{className:"flex space-x-2",children:N.areaTags.map(e=>(()=>{var l,r;let n=a.areaTags.includes(e),i=s(e.toLowerCase()),c=(null==i?void 0:null===(l=i.colors)||void 0===l?void 0:l.bgHex)||"#EBF5FF",o=(null==i?void 0:null===(r=i.colors)||void 0===r?void 0:r.textHex)||"#3B82F6";return(0,t.jsx)("button",{onClick:()=>T(e,"areaTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(n?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":""),style:n?{}:{backgroundColor:c,color:o},children:e},"area-".concat(e))})())})})]}),N.contextTags.length>0&&(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Context Tags"}),(0,t.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,t.jsx)("div",{className:"flex space-x-2",children:N.contextTags.map(e=>(()=>{var l,r;let n=a.contextTags.includes(e),i=s(e.toLowerCase()),c=(null==i?void 0:null===(l=i.colors)||void 0===l?void 0:l.bgHex)||"#F0F7FF",o=(null==i?void 0:null===(r=i.colors)||void 0===r?void 0:r.textHex)||"#2563EB";return(0,t.jsx)("button",{onClick:()=>T(e,"contextTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(n?"bg-gradient-to-r from-pink-400 to-orange-400 text-white":""),style:n?{}:{backgroundColor:c,color:o},children:e},"context-".concat(e))})())})})]})]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:p?(0,t.jsx)("div",{className:"space-y-4 max-w-lg mx-auto",children:[void 0,void 0,void 0,void 0,void 0].map((e,s)=>(0,t.jsx)(g.Z,{hasHeader:!0,hasFooter:!0},s))}):y?(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-red-500 mb-4",children:"Failed to load expenses. Please try again."}),(0,t.jsx)("button",{onClick:()=>b(),className:"btn-primary",children:"Retry"})]})}):0===j.length?(0,t.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCB0"})}),(0,t.jsx)("p",{className:"text-gray-500",children:"No expenses found. Start tracking your expenses in the chat!"})]})}):(0,t.jsx)(r.M,{initial:!1,children:(0,t.jsx)("div",{className:"space-y-3 max-w-lg mx-auto",children:w.map(e=>(0,t.jsx)(n.E.div,{layout:!0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3,ease:"easeInOut"},children:(0,t.jsx)(h.ZP,{expense:e,onDelete:()=>_(e.id),fullWidth:!0})},e.id))})})}),m&&(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:(0,t.jsx)("div",{className:"px-6 py-3 rounded-xl shadow-lg whitespace-nowrap ".concat("success"===m.type?"bg-green-400":"bg-red-400"," text-white font-medium text-center"),children:m.message})})]})]})})}}},function(e){e.O(0,[976,260,666,639,774,888,179],function(){return e(e.s=484)}),_N_E=e.O()}]);