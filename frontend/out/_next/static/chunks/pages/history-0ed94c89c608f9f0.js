(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[276],{484:function(e,t,s){(window.__NEXT_P=window.__NEXT_P||[]).push(["/history",function(){return s(8013)}])},9765:function(e,t,s){"use strict";s.d(t,{jK:function(){return u}});var a=s(5893),o=s(7294),r=s(1352),l=s(3742),n=s(3718),c=s(3071);s(4856);var i=s(4682),d=s(9108),x=s(8086);let f={USD:"$",EUR:"€",GBP:"\xa3",JPY:"\xa5",CAD:"C$",AUD:"A$",CHF:"Fr",CNY:"\xa5",INR:"₹",BRL:"R$"},u=e=>f[e]||e;t.ZP=e=>{var t,s;let{expense:f,messageId:g,onDelete:h,fullWidth:m=!1}=e,{getTag:p}=(0,x.e0)(),[v,y]=(0,o.useState)(!1),w=null;f.tag_id?w=p(f.tag_id):f.area_tags&&f.area_tags.length>0?w=p(f.area_tags[0].toLowerCase()):f.tag&&(w=f.tag);let b=(null==w?void 0:w.icon)||"tag",j=(null==w?void 0:null===(t=w.colors)||void 0===t?void 0:t.hex)||"#6b7280",N=(null==w?void 0:null===(s=w.colors)||void 0===s?void 0:s.hex)||"#d1d5db",_=async()=>{if(!f.id){console.error("No expense ID found:",f);return}let e=!1;try{await i.Z.deleteExpense(f.id),e=!0}catch(e){console.warn("Expense deletion skipped or failed:",e)}if(g)try{await d.Z.deleteMessage(g)}catch(e){console.error("Failed to delete message:",e),alert("Failed to delete message. Please try again."),y(!1);return}h(e?f.id:null,g),y(!1)};return(0,a.jsxs)("div",{className:"rounded-xl overflow-hidden shadow-md hover:shadow-lg transition-shadow bg-white ".concat(m?"w-full":"w-full min-w-[320px] max-w-[400px]"," border-2 border-l-4"),style:{borderLeftColor:N},children:[(0,a.jsxs)("div",{className:"flex justify-between items-center py-2 px-3 bg-gray-50 border-b-2 border-gray-100 gap-2",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("div",{className:"w-7 h-7 rounded-full flex items-center justify-center mr-2",children:(0,a.jsx)(c.Z,{iconName:b,iconColor:j,className:"text-gray-700",fallbackIcon:"tag"})}),(0,a.jsxs)("div",{className:"min-w-0 flex-1 max-w-[200px]",children:[(0,a.jsx)("h4",{className:"text-base font-semibold text-gray-800 truncate overflow-hidden text-ellipsis",title:f.short_text||"Expense",children:f.short_text||"Expense"}),(0,a.jsxs)("span",{className:"flex items-center text-xs text-gray-500 space-x-1",children:[(0,a.jsx)("span",{children:new Date(f.timestamp).toLocaleDateString(void 0,{month:"short",day:"numeric"})}),(0,a.jsx)("span",{children:"•"}),(0,a.jsx)("span",{children:new Date(f.timestamp).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit"})})]})]})]}),(0,a.jsxs)("div",{className:"font-bold whitespace-nowrap flex-shrink-0",children:[u(f.currency),parseFloat(f.amount).toFixed(2)]})]}),(0,a.jsxs)("div",{className:"px-3 py-2 flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"flex flex-wrap gap-1.5",children:[f.area_tags&&f.area_tags.map(e=>{var t,s,o;let r=p(e.toLowerCase()),l=(null==r?void 0:null===(t=r.colors)||void 0===t?void 0:t.bgHex)||"#EBF5FF",n=(null==r?void 0:null===(s=r.colors)||void 0===s?void 0:s.textHex)||"#3B82F6";return null==r||null===(o=r.colors)||void 0===o||o.hex,null==r||r.icon,(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-semibold",style:{backgroundColor:l,color:n},children:e},"area-".concat(e))}),f.context_tags&&f.context_tags.map(e=>{var t,s,o;let r=p(e.toLowerCase()),l=(null==r?void 0:null===(t=r.colors)||void 0===t?void 0:t.bgHex)||"#F0F7FF",n=(null==r?void 0:null===(s=r.colors)||void 0===s?void 0:s.textHex)||"#2563EB";return null==r||null===(o=r.colors)||void 0===o||o.hex,null==r||r.icon,(0,a.jsx)("span",{className:"px-2 py-0.5 rounded-full text-xs font-semibold",style:{backgroundColor:l,color:n},children:e},"context-".concat(e))})]}),v?(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("button",{onClick:()=>y(!1),className:"p-1 text-xs text-gray-600 bg-gray-100 rounded-full hover:bg-gray-200 transition-colors",children:(0,a.jsx)(r.Z,{className:"w-3 h-3"})}),(0,a.jsx)("button",{onClick:_,className:"p-1 text-xs text-white rounded-full hover:opacity-90 transition-opacity",style:{background:"linear-gradient(45deg, #E74C3C, #cf8ef9)"},children:(0,a.jsx)(l.Z,{className:"w-3 h-3"})})]}):(0,a.jsx)("button",{onClick:()=>y(!0),className:"text-gray-400 hover:text-gray-600 transition-colors p-1",children:(0,a.jsx)(n.Z,{className:"w-4 h-4"})})]})]})}},3071:function(e,t,s){"use strict";var a=s(5893),o=s(7294),r=s(2062);t.Z=o.memo(e=>{let{iconName:t,iconColor:s,size:o=24,className:l="",fallbackIcon:n="tag",style:c={}}=e,i={color:s,...c};return(0,a.jsx)(r.Z,{iconName:t||n,size:o,className:l,defaultIcon:n,style:i})},(e,t)=>e.iconName===t.iconName&&e.iconColor===t.iconColor&&e.size===t.size&&e.className===t.className&&e.fallbackIcon===t.fallbackIcon&&JSON.stringify(e.style)===JSON.stringify(t.style))},8013:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return p}});var a=s(5893),o=s(7294),r=s(1526),l=s(3495),n=s(9008),c=s.n(n);s(1664);var i=s(5493),d=s(2537),x=s(8086),f=s(558),u=s(4682),g=s(9765),h=s(816);new h.Z(0,0,0,1,[{offset:0,color:"#fb923c"},{offset:1,color:"#f97316"}]),new h.Z(0,0,0,1,[{offset:0,color:"#4ade80"},{offset:1,color:"#22c55e"}]),new h.Z(0,0,0,1,[{offset:0,color:"#fdba74"},{offset:1,color:"#fb923c"}]),new h.Z(0,0,0,1,[{offset:0,color:"#c084fc"},{offset:1,color:"#a855f7"}]),new h.Z(0,0,0,1,[{offset:0,color:"#f87171"},{offset:1,color:"#ef4444"}]),new h.Z(0,0,0,1,[{offset:0,color:"#60a5fa"},{offset:1,color:"#3b82f6"}]),new h.Z(0,0,0,1,[{offset:0,color:"#93c5fd"},{offset:1,color:"#60a5fa"}]),new h.Z(0,0,0,1,[{offset:0,color:"#4ade80"},{offset:1,color:"#22c55e"}]),new h.Z(0,0,0,1,[{offset:0,color:"#facc15"},{offset:1,color:"#eab308"}]),new h.Z(0,0,0,1,[{offset:0,color:"#2dd4bf"},{offset:1,color:"#14b8a6"}]),new h.Z(0,0,0,1,[{offset:0,color:"#818cf8"},{offset:1,color:"#6366f1"}]),new h.Z(0,0,0,1,[{offset:0,color:"#3b82f6"},{offset:1,color:"#2563eb"}]),new h.Z(0,0,0,1,[{offset:0,color:"#f472b6"},{offset:1,color:"#ec4899"}]),new h.Z(0,0,0,1,[{offset:0,color:"#fbcfe8"},{offset:1,color:"#f9a8d4"}]),new h.Z(0,0,0,1,[{offset:0,color:"#e5e7eb"},{offset:1,color:"#d1d5db"}]);var m=s(5658);function p(){let{user:e}=(0,d.a)(),{getTag:t}=(0,x.e0)(),[s,n]=(0,o.useState)([]),[h,p]=(0,o.useState)(!0),[v,y]=(0,o.useState)(null),[w,b]=(0,o.useState)({areaTags:[],contextTags:[]}),[j,N]=(0,o.useState)({areaTags:[],contextTags:[]}),[_,T]=(0,o.useState)(null),[E,Z]=(0,o.useState)(0),C=e=>{let t=new Set,s=new Set;return e.forEach(e=>{Array.isArray(e.area_tags)&&e.area_tags.forEach(e=>t.add(e)),Array.isArray(e.context_tags)&&e.context_tags.forEach(e=>s.add(e))}),{areaTags:[...t],contextTags:[...s]}},F=(e,t)=>{b(s=>{let a=[...s[t]],o=a.indexOf(e);return -1===o?a.push(e):a.splice(o,1),{...s,[t]:a}})},k=e=>{let t=s.filter(t=>t.id!==e);n(t),N(C(t)),Z(t.reduce((e,t)=>e+parseFloat(t.amount||0),0)),T({type:"success",message:"Expense deleted successfully"}),setTimeout(()=>T(null),3e3)},S=e=>{k(e)};return(0,o.useEffect)(()=>{if(!e)return;let t=async()=>{try{p(!0);let e=await u.Z.getExpenses();if(console.log("Raw expense data from API:",e),!Array.isArray(e)){console.error("API did not return an array for expenses:",e),n([]),N({areaTags:[],contextTags:[]}),Z(0),y("Failed to load expenses. Unexpected data format."),p(!1);return}let t=e.filter(e=>e&&"number"==typeof e.amount&&e.timestamp),s=t.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));n(s),N(C(s));let a=s.reduce((e,t)=>e+parseFloat(t.amount||0),0);Z(a),y(null)}catch(e){console.error("Failed to fetch expenses:",e),y("Failed to load expenses. Please try again later."),n([]),N({areaTags:[],contextTags:[]}),Z(0)}p(!1)};t()},[e]),(0,a.jsx)(f.i,{children:(0,a.jsxs)(i.Z,{children:[(0,a.jsx)(c(),{children:(0,a.jsx)("title",{children:"Expense History | Piggy"})}),(0,a.jsxs)("div",{className:"h-[calc(100vh-64px)] flex flex-col bg-white",children:[(0,a.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,a.jsx)("div",{className:"flex justify-between items-center",children:(0,a.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Expense History"})}),(0,a.jsxs)("div",{className:"space-y-2 mt-4",children:[j.areaTags.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Area Tags"}),(0,a.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,a.jsx)("div",{className:"flex space-x-2",children:j.areaTags.map(e=>(()=>{var s,o;let r=w.areaTags.includes(e),l=t(e.toLowerCase()),n=(null==l?void 0:null===(s=l.colors)||void 0===s?void 0:s.bgHex)||"#EBF5FF",c=(null==l?void 0:null===(o=l.colors)||void 0===o?void 0:o.textHex)||"#3B82F6";return(0,a.jsx)("button",{onClick:()=>F(e,"areaTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(r?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":""),style:r?{}:{backgroundColor:n,color:c},children:e},"area-".concat(e))})())})})]}),j.contextTags.length>0&&(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Context Tags"}),(0,a.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,a.jsx)("div",{className:"flex space-x-2",children:j.contextTags.map(e=>(()=>{var s,o;let r=w.contextTags.includes(e),l=t(e.toLowerCase()),n=(null==l?void 0:null===(s=l.colors)||void 0===s?void 0:s.bgHex)||"#F0F7FF",c=(null==l?void 0:null===(o=l.colors)||void 0===o?void 0:o.textHex)||"#2563EB";return(0,a.jsx)("button",{onClick:()=>F(e,"contextTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(r?"bg-gradient-to-r from-pink-400 to-orange-400 text-white":""),style:r?{}:{backgroundColor:n,color:c},children:e},"context-".concat(e))})())})})]})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:h?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)(m.Z,{fullPage:!0,text:"Loading expenses..."})}):v?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsx)("p",{className:"text-red-500",children:v})}):0===s.length?(0,a.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCB0"})}),(0,a.jsx)("p",{className:"text-gray-500",children:"No expenses found. Start tracking your expenses in the chat!"})]})}):(0,a.jsx)(r.M,{initial:!1,children:(0,a.jsx)("div",{className:"space-y-3 max-w-lg mx-auto",children:(w.areaTags.length||w.contextTags.length?s.filter(e=>{let t=!w.areaTags.length||e.area_tags&&w.areaTags.some(t=>e.area_tags.includes(t)),s=!w.contextTags.length||e.context_tags&&w.contextTags.some(t=>e.context_tags.includes(t));return t&&s}):s).map(e=>(0,a.jsx)(l.E.div,{layout:!0,initial:{opacity:0,height:0},animate:{opacity:1,height:"auto"},exit:{opacity:0,height:0},transition:{duration:.3,ease:"easeInOut"},children:(0,a.jsx)(g.ZP,{expense:e,onDelete:()=>S(e.id),fullWidth:!0})},e.id))})})}),_&&(0,a.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:(0,a.jsx)("div",{className:"px-6 py-3 rounded-xl shadow-lg whitespace-nowrap ".concat("success"===_.type?"bg-green-400":"bg-red-400"," text-white font-medium text-center"),children:_.message})})]})]})})}},9108:function(e,t,s){"use strict";var a=s(7066),o=s(8346);let r="https://moneymanager-backend-qwbwl7ldoa-oa.a.run.app";console.log("Using API URL:",r);let l=async()=>{let e=(0,o.v0)(),t=e.currentUser;if(!t)throw Error("User not authenticated");return await t.getIdToken()},n=async()=>{let e=await l();return a.Z.create({baseURL:r,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})};t.Z={getAuthToken:l,async getMessages(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30;arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{let t=await n(),s="/api/chat/messages?limit=".concat(e);console.log("Fetching messages from:",s);let a=await t.get(s);return console.log("Messages fetched successfully"),a.data}catch(e){var t;return console.error("Error fetching messages:",e),console.error("Response details:",null===(t=e.response)||void 0===t?void 0:t.data),console.log("Returning fallback messages"),[{id:"fallback-1",content:"Welcome to Money Manager! The message service is currently experiencing issues. Your previous messages will appear when service is restored.",user_id:"system",timestamp:new Date().toISOString(),message_type:"system"}]}},async sendMessage(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"user";try{let s=await n(),a=await s.post("/api/chat/messages",{content:e,message_type:t});return a.data}catch(e){throw console.error("Error sending message:",e),e}},async deleteMessage(e){try{let t=await n();return await t.delete("/api/chat/messages/".concat(e)),!0}catch(e){throw console.error("Error deleting message:",e),e}},async parseExpense(e){try{let t=await n();console.log("Sending expense parser request:",{text:e,save_to_db:!0});let s=await t.post("/api/agents/expense_parser/",{text:e,save_to_db:!0});return console.log("Expense parser response:",s.data),s.data}catch(e){var t;throw console.error("Error parsing expense:",e),console.error("Error details:",null===(t=e.response)||void 0===t?void 0:t.data),e}}}}},function(e){e.O(0,[976,260,871,485,770,774,888,179],function(){return e(e.s=484)}),_N_E=e.O()}]);