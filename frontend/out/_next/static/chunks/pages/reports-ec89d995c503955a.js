(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[53],{1373:function(e,t,a){"use strict";a.d(t,{Z:function(){return u}});var r=a(7294);/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let s=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),n=e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,a)=>a?a.toUpperCase():t.toLowerCase()),l=e=>{let t=n(e);return t.charAt(0).toUpperCase()+t.slice(1)},o=(...e)=>e.filter((e,t,a)=>!!e&&""!==e.trim()&&a.indexOf(e)===t).join(" ").trim(),i=e=>{for(let t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0};/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var c={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.507.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let d=(0,r.forwardRef)(({color:e="currentColor",size:t=24,strokeWidth:a=2,absoluteStrokeWidth:s,className:n="",children:l,iconNode:d,...u},h)=>(0,r.createElement)("svg",{ref:h,...c,width:t,height:t,stroke:e,strokeWidth:s?24*Number(a)/Number(t):a,className:o("lucide",n),...!l&&!i(u)&&{"aria-hidden":"true"},...u},[...d.map(([e,t])=>(0,r.createElement)(e,t)),...Array.isArray(l)?l:[l]])),u=(e,t)=>{let a=(0,r.forwardRef)(({className:a,...n},i)=>(0,r.createElement)(d,{ref:i,iconNode:t,className:o(`lucide-${s(l(e))}`,`lucide-${e}`,a),...n}));return a.displayName=l(e),a}},8442:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/reports",function(){return a(7410)}])},3071:function(e,t,a){"use strict";var r=a(5893),s=a(7294),n=a(2062);t.Z=s.memo(e=>{let{iconName:t,iconColor:a,size:s=24,className:l="",fallbackIcon:o="tag",style:i={}}=e,c={color:a,...i};return(0,r.jsx)(n.Z,{iconName:t||o,size:s,className:l,defaultIcon:o,style:c})},(e,t)=>e.iconName===t.iconName&&e.iconColor===t.iconColor&&e.size===t.size&&e.className===t.className&&e.fallbackIcon===t.fallbackIcon&&JSON.stringify(e.style)===JSON.stringify(t.style))},7410:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var r=a(5893),s=a(7294),n=a(9008),l=a.n(n),o=a(5493),i=a(2537),c=a(558),d=a(1373);let u=(0,d.Z)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);var h=e=>{let{onDateRangeChange:t}=e,[a,n]=(0,s.useState)(!1),[l,o]=(0,s.useState)("thisMonth"),[i,c]=(0,s.useState)(""),[d,h]=(0,s.useState)(""),m=[{id:"today",label:"Today"},{id:"thisWeek",label:"This Week"},{id:"thisMonth",label:"This Month"},{id:"lastMonth",label:"Last Month"},{id:"last3Months",label:"Last 3 Months"},{id:"thisYear",label:"This Year"},{id:"custom",label:"Custom Range"}],g=e=>{let t,a;let r=new Date;switch(e){case"today":t=new Date(r),a=new Date(r);break;case"thisWeek":(t=new Date(r)).setDate(r.getDate()-r.getDay()),a=new Date(r);break;case"thisMonth":default:t=new Date(r.getFullYear(),r.getMonth(),1),a=new Date(r);break;case"lastMonth":t=new Date(r.getFullYear(),r.getMonth()-1,1),a=new Date(r.getFullYear(),r.getMonth(),0);break;case"last3Months":t=new Date(r.getFullYear(),r.getMonth()-3,1),a=new Date(r);break;case"thisYear":t=new Date(r.getFullYear(),0,1),a=new Date(r);break;case"custom":t=i?new Date(i):null,a=d?new Date(d):null}return{startDate:t,endDate:a}},x=e=>e?e.toLocaleDateString("en-US",{day:"numeric",month:"short",year:"numeric"}):"",p=e=>{o(e),n(!1);let{startDate:a,endDate:r}=g(e);t({startDate:a,endDate:r,rangeId:e})};return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsxs)("button",{onClick:()=>n(!a),className:"flex items-center justify-between w-full px-4 py-2 bg-white rounded-xl shadow-sm border border-gray-100 text-sm",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(u,{className:"w-4 h-4 mr-2 text-gray-500"}),(0,r.jsx)("span",{className:"text-gray-700 font-medium",children:(()=>{if("custom"===l&&i&&d)return"".concat(x(new Date(i))," - ").concat(x(new Date(d)));let e=m.find(e=>e.id===l);return e?e.label:"This Month"})()})]}),(0,r.jsx)("svg",{className:"w-4 h-4 text-gray-500 transition-transform ".concat(a?"rotate-180":""),fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M19 9l-7 7-7-7"})})]}),a&&(0,r.jsxs)("div",{className:"absolute z-10 mt-2 w-full bg-white rounded-xl shadow-lg border border-gray-100 overflow-hidden",children:[(0,r.jsx)("div",{className:"p-2",children:m.map(e=>(0,r.jsx)("button",{onClick:()=>p(e.id),className:"w-full text-left px-3 py-2 text-sm rounded-lg transition-colors ".concat(l===e.id?"bg-gradient-to-r from-blue-400 to-purple-500 text-white":"text-gray-700 hover:bg-gray-100"),children:e.label},e.id))}),"custom"===l&&(0,r.jsxs)("div",{className:"p-3 border-t border-gray-100",children:[(0,r.jsxs)("div",{className:"grid grid-cols-2 gap-2 mb-2",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"Start Date"}),(0,r.jsx)("input",{type:"date",value:i,onChange:e=>c(e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-200 rounded-lg"})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)("label",{className:"block text-xs text-gray-500 mb-1",children:"End Date"}),(0,r.jsx)("input",{type:"date",value:d,onChange:e=>h(e.target.value),className:"w-full px-2 py-1 text-sm border border-gray-200 rounded-lg"})]})]}),(0,r.jsx)("button",{onClick:()=>{if(i&&d){let{startDate:e,endDate:a}=g("custom");t({startDate:e,endDate:a,rangeId:"custom"}),n(!1)}},disabled:!i||!d,className:"w-full py-2 text-sm rounded-lg text-center ".concat(i&&d?"bg-gradient-to-r from-blue-400 to-purple-500 text-white":"bg-gray-100 text-gray-400"),children:"Apply Custom Range"})]})]})]})},m=a(6219),g=a(5658),x=a(2062),p=a(3071),w=a(8086),y=a(1710),f=a(4856),b=e=>{let{expenses:t,isLoading:a}=e,[n,l]=(0,s.useState)({}),[o,i]=(0,s.useState)(0),[c,d]=(0,s.useState)([]),[u,h]=(0,s.useState)("$"),{getTag:b}=(0,w.e0)();return((0,s.useEffect)(()=>{let e=async()=>{try{let e=await y.Z.getUserData();h((0,f.jK)(e.preferred_currency))}catch(e){console.error("Error fetching user currency:",e)}};e()},[]),(0,s.useEffect)(()=>{if(!t||0===t.length){d([]),i(0);return}let e=t.reduce((e,t)=>e+t.amount,0);i(e);let a={};t.forEach(e=>{e.area_tags&&e.area_tags.length>0?e.area_tags.forEach(t=>{a[t]||(a[t]={name:t,amount:0,count:0,icon:e.main_tag_icon||t,tagId:e.tag_id}),a[t].amount+=e.amount,a[t].count+=1}):(a.Other||(a.Other={name:"Other",amount:0,count:0,icon:"HelpCircle"}),a.Other.amount+=e.amount,a.Other.count+=1)});let r=Object.values(a).map(t=>({...t,percentage:Math.round(t.amount/e*100)}));r.sort((e,t)=>t.amount-e.amount),d(r);let s=r.map(e=>{var t;let a=e.tagId?b(e.tagId):b(e.name),r=(null==a?void 0:null===(t=a.colors)||void 0===t?void 0:t.hex)||"#d1d5db";return{name:e.name,value:e.amount,itemStyle:{color:r}}});l({tooltip:{trigger:"item",formatter:e=>{let t=r.find(t=>t.name===e.name);return'\n            <div style="padding: 8px;">\n              <div style="font-weight: bold; margin-bottom: 4px;">'.concat(e.name,"</div>\n              <div>Amount: ").concat(u).concat(e.value.toFixed(2),"</div>\n              <div>Percentage: ").concat(e.percent,"%</div>\n              <div>Expenses: ").concat(t?t.count:0,"</div>\n            </div>\n          ")}},legend:{orient:"vertical",right:0,top:"center",type:"scroll",textStyle:{color:"#666"}},series:[{name:"Expenses by Category",type:"pie",radius:["40%","70%"],center:["40%","50%"],avoidLabelOverlap:!0,itemStyle:{borderRadius:10,borderColor:"#fff",borderWidth:2},label:{show:!1},emphasis:{label:{show:!1},scale:!0,scaleSize:5},labelLine:{show:!1},data:s}]})},[t,b,u]),a)?(0,r.jsx)("div",{className:"bg-white rounded-3xl shadow-md p-6 flex items-center justify-center",style:{minHeight:"300px"},children:(0,r.jsx)(g.Z,{})}):t&&0!==t.length?(0,r.jsxs)("div",{className:"bg-white rounded-3xl shadow-md p-6",children:[(0,r.jsx)("h2",{className:"text-lg font-semibold text-gray-800 mb-2",children:"Spending by Category"}),(0,r.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Total: ",u,o.toFixed(2)]}),(0,r.jsx)("div",{className:"h-80",children:(0,r.jsx)(m.Z,{option:n,style:{height:"100%",width:"100%"},opts:{renderer:"canvas"},notMerge:!0,lazyUpdate:!0})}),(0,r.jsx)("div",{className:"mt-4 space-y-3",children:c.map((e,t)=>{var a;let s=e.tagId?b(e.tagId):b(e.name),n=(null==s?void 0:null===(a=s.colors)||void 0===a?void 0:a.hex)||"#d1d5db";return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(p.Z,{iconName:(null==s?void 0:s.icon)||"tag",iconColor:n,size:20,className:"mr-2",fallbackIcon:"tag"}),(0,r.jsx)("span",{className:"text-sm font-medium text-gray-700",children:e.name})]}),(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("span",{className:"text-sm text-gray-500 mr-2",children:[u,e.amount.toFixed(2)]}),(0,r.jsxs)("span",{className:"text-xs font-medium px-2 py-1 rounded-full",style:{backgroundColor:"".concat(n,"20"),color:n},children:[e.percentage,"%"]})]})]},t)})})]}):(0,r.jsxs)("div",{className:"bg-white rounded-3xl shadow-md p-6 flex flex-col items-center justify-center",style:{minHeight:"300px"},children:[(0,r.jsx)(x.Z,{name:"PieChart",className:"w-12 h-12 text-gray-300 mb-4"}),(0,r.jsx)("p",{className:"text-gray-500 text-center",children:"No expense data available for this period"})]})},v=a(4682);function j(){let{user:e}=(0,i.a)(),[t,a]=(0,s.useState)(!0),[n,d]=(0,s.useState)([]),[u,m]=(0,s.useState)([]),[g,x]=(0,s.useState)({startDate:new Date(new Date().getFullYear(),new Date().getMonth(),1),endDate:new Date,rangeId:"thisMonth"});return(0,s.useEffect)(()=>{let e=async()=>{a(!0);try{let e=await v.Z.getExpenses();d(e)}catch(e){console.error("Error fetching expenses:",e)}finally{a(!1)}};e()},[]),(0,s.useEffect)(()=>{if(!n.length){m([]);return}let{startDate:e,endDate:t}=g,a=e instanceof Date?e:new Date(e),r=t instanceof Date?t:new Date(t);a.setHours(0,0,0,0),r.setHours(23,59,59,999);let s=n.filter(e=>{let t=new Date(e.timestamp);return t>=a&&t<=r});m(s)},[n,g]),(0,r.jsx)(c.i,{children:(0,r.jsxs)(o.Z,{children:[(0,r.jsx)(l(),{children:(0,r.jsx)("title",{children:"Reports | Piggy"})}),(0,r.jsxs)("div",{className:"px-4 py-6 max-w-lg mx-auto",children:[(0,r.jsxs)("header",{className:"mb-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold text-gray-800",children:"Reports"}),(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"View your spending analytics"}),(0,r.jsx)(h,{onDateRangeChange:e=>{x(e)}})]}),(0,r.jsx)("div",{className:"mt-6",children:(0,r.jsx)(b,{expenses:u,isLoading:t})})]})]})})}},1710:function(e,t,a){"use strict";var r=a(7066),s=a(8346);let n="https://moneymanager-backend-qwbwl7ldoa-oa.a.run.app";console.log("User service using API URL:",n);let l=async()=>{let e=(0,s.v0)(),t=e.currentUser;if(!t)throw Error("User not authenticated");return await t.getIdToken()},o=async()=>{let e=await l();return r.Z.create({baseURL:n,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})};t.Z={async getUserData(){try{let e=await o(),t=await e.get("/api/users/me");return t.data}catch(e){throw console.error("Error fetching user data:",e),e}},async updateUserData(e){try{let t=await o(),a=await t.patch("/api/users/me",e);return a.data}catch(e){throw console.error("Error updating user data:",e),e}}}}},function(e){e.O(0,[976,260,871,219,770,774,888,179],function(){return e(e.s=8442)}),_N_E=e.O()}]);