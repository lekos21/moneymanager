(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[276],{484:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/history",function(){return r(8013)}])},8013:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return m}});var o=r(5893),a=r(7294),s=r(9008),n=r.n(s);r(1664);var l=r(5493),c=r(2537),d=r(558),i=r(4682),x=r(9281),f=r(816);let g={food:{border:"border-orange-400",bg:"bg-orange-50",text:"text-orange-600",hex:"#f97316",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#fb923c"},{offset:1,color:"#f97316"}])},groceries:{border:"border-green-500",bg:"bg-green-50",text:"text-green-600",hex:"#22c55e",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#4ade80"},{offset:1,color:"#22c55e"}])},restaurant:{border:"border-orange-400",bg:"bg-orange-50",text:"text-orange-600",hex:"#fb923c",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#fdba74"},{offset:1,color:"#fb923c"}])},shopping:{border:"border-purple-500",bg:"bg-purple-50",text:"text-purple-600",hex:"#a855f7",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#c084fc"},{offset:1,color:"#a855f7"}])},entertainment:{border:"border-red-500",bg:"bg-red-50",text:"text-red-600",hex:"#ef4444",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#f87171"},{offset:1,color:"#ef4444"}])},travel:{border:"border-blue-500",bg:"bg-blue-50",text:"text-blue-600",hex:"#3b82f6",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#60a5fa"},{offset:1,color:"#3b82f6"}])},transport:{border:"border-blue-400",bg:"bg-blue-50",text:"text-blue-600",hex:"#60a5fa",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#93c5fd"},{offset:1,color:"#60a5fa"}])},health:{border:"border-green-400",bg:"bg-green-50",text:"text-green-600",hex:"#22c55e",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#4ade80"},{offset:1,color:"#22c55e"}])},utilities:{border:"border-yellow-500",bg:"bg-yellow-50",text:"text-yellow-600",hex:"#eab308",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#facc15"},{offset:1,color:"#eab308"}])},home:{border:"border-teal-500",bg:"bg-teal-50",text:"text-teal-600",hex:"#14b8a6",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#2dd4bf"},{offset:1,color:"#14b8a6"}])},personal:{border:"border-indigo-500",bg:"bg-indigo-50",text:"text-indigo-600",hex:"#6366f1",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#818cf8"},{offset:1,color:"#6366f1"}])},education:{border:"border-blue-600",bg:"bg-blue-50",text:"text-blue-700",hex:"#2563eb",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#3b82f6"},{offset:1,color:"#2563eb"}])},gift:{border:"border-pink-500",bg:"bg-pink-50",text:"text-pink-600",hex:"#ec4899",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#f472b6"},{offset:1,color:"#ec4899"}])},clothes:{border:"border-pink-300",bg:"bg-pink-50",text:"text-pink-600",hex:"#f9a8d4",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#fbcfe8"},{offset:1,color:"#f9a8d4"}])},default:{border:"border-gray-300",bg:"bg-gray-50",text:"text-gray-600",hex:"#d1d5db",gradient:new f.Z(0,0,0,1,[{offset:0,color:"#e5e7eb"},{offset:1,color:"#d1d5db"}])}},b=function(e){var t;let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"hex",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e)return g.default[r];let a=e.toLowerCase(),s=o["area-".concat(a)]||o["context-".concat(a)];if(null==s?void 0:null===(t=s.colors)||void 0===t?void 0:t.hex){if("hex"===r)return s.colors.hex;if("bgHex"===r)return s.colors.bgHex||"".concat(s.colors.hex,"20");if("textHex"===r)return s.colors.textHex||s.colors.hex;if(("border"===r||"bg"===r||"text"===r)&&s.colors[r])return s.colors[r]}let n=g[a]||g.default;if(console.log("[tagUtils] Using fallback color: ".concat(n[r])),"gradient"===r&&!n.gradient&&n.hex){let e=n.hex;return new f.Z(0,0,0,1,[{offset:0,color:e},{offset:1,color:e}])}return n[r]},u=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(e,"bg",t)},h=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return b(e,"text",t)};var p=r(5658);function m(){let{user:e}=(0,c.a)(),[t,r]=(0,a.useState)([]),[s,f]=(0,a.useState)(!0),[g,b]=(0,a.useState)(null),[m,w]=(0,a.useState)({areaTags:[],contextTags:[]}),[y,j]=(0,a.useState)({areaTags:[],contextTags:[]}),[v,N]=(0,a.useState)(null),[T,Z]=(0,a.useState)(0),_=e=>{let t=new Set,r=new Set;return e.forEach(e=>{Array.isArray(e.area_tags)&&e.area_tags.forEach(e=>t.add(e)),Array.isArray(e.context_tags)&&e.context_tags.forEach(e=>r.add(e))}),{areaTags:[...t],contextTags:[...r]}},k=(e,t)=>{w(r=>{let o=[...r[t]],a=o.indexOf(e);return -1===a?o.push(e):o.splice(a,1),{...r,[t]:o}})};(0,a.useEffect)(()=>{if(!e)return;let t=async()=>{try{f(!0);let e=await i.Z.getExpenses();if(console.log("Raw expense data from API:",e),!Array.isArray(e)){console.error("API did not return an array for expenses:",e),r([]),j({areaTags:[],contextTags:[]}),Z(0),b("Failed to load expenses. Unexpected data format."),f(!1);return}let t=e.filter(e=>e&&"number"==typeof e.amount&&e.timestamp),o=t.sort((e,t)=>new Date(t.timestamp)-new Date(e.timestamp));r(o),j(_(o));let a=o.reduce((e,t)=>e+parseFloat(t.amount||0),0);Z(a),b(null)}catch(e){console.error("Failed to fetch expenses:",e),b("Failed to load expenses. Please try again later."),r([]),j({areaTags:[],contextTags:[]}),Z(0)}f(!1)};t()},[e]);let E=e=>{r(t=>t.filter(t=>t.id!==e));let o=t.filter(t=>t.id!==e);j(_(o));let a=o.reduce((e,t)=>e+parseFloat(t.amount||0),0);Z(a),N({type:"success",message:"Expense deleted successfully"}),setTimeout(()=>N(null),3e3)};return(0,o.jsx)(d.i,{children:(0,o.jsxs)(l.Z,{children:[(0,o.jsx)(n(),{children:(0,o.jsx)("title",{children:"Expense History | MoneyManager"})}),(0,o.jsxs)("div",{className:"h-[calc(100vh-64px)] flex flex-col bg-white",children:[(0,o.jsxs)("div",{className:"p-4 border-b border-gray-200",children:[(0,o.jsx)("div",{className:"flex justify-between items-center",children:(0,o.jsx)("h1",{className:"text-xl font-bold text-gray-800",children:"Expense History"})}),(0,o.jsxs)("div",{className:"space-y-2 mt-4",children:[y.areaTags.length>0&&(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Area Tags"}),(0,o.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,o.jsx)("div",{className:"flex space-x-2",children:y.areaTags.map(e=>(0,o.jsx)("button",{onClick:()=>k(e,"areaTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(m.areaTags.includes(e)?"bg-gradient-to-r from-blue-500 to-purple-600 text-white":"".concat(u(e.toLowerCase())," ").concat(h(e.toLowerCase()))),children:e},"area-".concat(e)))})})]}),y.contextTags.length>0&&(0,o.jsxs)("div",{children:[(0,o.jsx)("p",{className:"text-xs text-gray-500 mb-1",children:"Context Tags"}),(0,o.jsx)("div",{className:"flex overflow-x-auto pb-2 scrollbar-hide",children:(0,o.jsx)("div",{className:"flex space-x-2",children:y.contextTags.map(e=>(0,o.jsx)("button",{onClick:()=>k(e,"contextTags"),className:"flex-shrink-0 px-3 py-1 rounded-full text-xs font-semibold ".concat(m.contextTags.includes(e)?"bg-gradient-to-r from-pink-400 to-orange-400 text-white":"bg-blue-50 text-blue-600"),children:e},"context-".concat(e)))})})]})]})]}),(0,o.jsx)("div",{className:"flex-1 overflow-y-auto p-4",children:s?(0,o.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,o.jsx)(p.Z,{fullPage:!0,text:"Loading expenses..."})}):g?(0,o.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,o.jsx)("p",{className:"text-red-500",children:g})}):0===t.length?(0,o.jsx)("div",{className:"flex justify-center items-center h-full",children:(0,o.jsxs)("div",{className:"text-center",children:[(0,o.jsx)("div",{className:"w-20 h-20 bg-gray-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,o.jsx)("span",{className:"text-3xl",children:"\uD83D\uDCB0"})}),(0,o.jsx)("p",{className:"text-gray-500",children:"No expenses found. Start tracking your expenses in the chat!"})]})}):(0,o.jsx)("div",{className:"space-y-3 max-w-lg mx-auto",children:(m.areaTags.length||m.contextTags.length?t.filter(e=>{let t=!m.areaTags.length||e.area_tags&&m.areaTags.some(t=>e.area_tags.includes(t)),r=!m.contextTags.length||e.context_tags&&m.contextTags.some(t=>e.context_tags.includes(t));return t&&r}):t).map(e=>(0,o.jsx)(x.ZP,{expense:e,onDelete:()=>E(e.id),fullWidth:!0},e.id))})}),v&&(0,o.jsx)("div",{className:"fixed inset-0 flex items-center justify-center z-50 pointer-events-none",children:(0,o.jsx)("div",{className:"px-6 py-3 rounded-xl shadow-lg whitespace-nowrap ".concat("success"===v.type?"bg-green-400":"bg-red-400"," text-white font-medium text-center"),children:v.message})})]})]})})}}},function(e){e.O(0,[976,260,871,848,281,774,888,179],function(){return e(e.s=484)}),_N_E=e.O()}]);