(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[229],{5732:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/home",function(){return a(9126)}])},9126:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return j}});var s=a(5893),r=a(7294),l=a(1163),n=a(9008),o=a.n(n),i=a(1664),c=a.n(i),d=a(5493),h=a(2537),m=a(558),x=a(4682),u=a(1710),f=a(2062),g=a(5658),y=a(6219),p=a(816),w=a(4856),b=e=>{let{activeTab:t,monthlyTotal:a,weeklyTotal:l,dailyExpenses:n,weeklyExpenses:o,budget:i}=e,[c,d]=(0,r.useState)({}),[h,m]=(0,r.useState)("$");return(0,r.useEffect)(()=>{let e=async()=>{try{let e=await u.Z.getUserData();m((0,w.jK)(e.preferred_currency))}catch(e){console.error("Error fetching currency:",e)}};e()},[]),(0,r.useEffect)(()=>{if("monthly"===t){let e=n.map(e=>e.day),t=n.map(e=>e.amount);d({grid:{top:20,right:"1%",bottom:30,left:"1%",containLabel:!1},tooltip:{trigger:"axis",formatter:function(e){let t=new Date,a=t.toLocaleString("en-US",{month:"short"});return"".concat(a,", ").concat(e[0].name,": ").concat(h).concat(e[0].value.toFixed(2))},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#fff",textStyle:{color:"#333"}},axisPointer:{lineStyle:{color:"rgba(255, 255, 255, 0.8)",width:2,type:"dashed"}},xAxis:{type:"category",data:e,axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.5)",width:2}},axisLabel:{color:"rgba(255, 255, 255, 0.8)",fontSize:10,interval:1,align:"center",margin:12},axisTick:{show:!0,alignWithLabel:!0,lineStyle:{color:"rgba(255, 255, 255, 0.5)"}}},yAxis:{type:"value",show:!1},series:[{data:t,type:"bar",barWidth:"40%",itemStyle:{color:new p.Z(0,0,0,1,[{offset:0,color:"rgba(255, 255, 255, 0.9)"},{offset:1,color:"rgba(255, 255, 255, 0.3)"}]),borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:new p.Z(0,0,0,1,[{offset:0,color:"rgba(255, 255, 255, 1)"},{offset:1,color:"rgba(255, 255, 255, 0.5)"}])}}}]})}else{let e=o.map(e=>e.day),t=o.map(e=>e.amount);d({grid:{top:20,right:"1%",bottom:30,left:"1%",containLabel:!1},tooltip:{trigger:"axis",formatter:function(e){return"".concat(e[0].name,": ").concat(h).concat(e[0].value.toFixed(2))},backgroundColor:"rgba(255, 255, 255, 0.9)",borderColor:"#fff",textStyle:{color:"#333"}},axisPointer:{lineStyle:{color:"rgba(255, 255, 255, 0.8)",width:2,type:"dashed"}},xAxis:{type:"category",data:e,axisLine:{lineStyle:{color:"rgba(255, 255, 255, 0.5)",width:2}},axisLabel:{color:"rgba(255, 255, 255, 0.8)",fontSize:10},axisTick:{show:!0,alignWithLabel:!0,lineStyle:{color:"rgba(255, 255, 255, 0.5)"}}},yAxis:{type:"value",show:!1},series:[{data:t,type:"bar",barWidth:"60%",itemStyle:{color:new p.Z(0,0,0,1,[{offset:0,color:"rgba(255, 255, 255, 0.9)"},{offset:1,color:"rgba(255, 255, 255, 0.3)"}]),borderRadius:[4,4,0,0]},emphasis:{itemStyle:{color:new p.Z(0,0,0,1,[{offset:0,color:"rgba(255, 255, 255, 1)"},{offset:1,color:"rgba(255, 255, 255, 0.5)"}])}}}]})}},[t,n,o,a,l,i]),(0,s.jsxs)("div",{className:"rounded-3xl shadow-lg p-6 text-white overflow-hidden",style:{background:"linear-gradient(135deg, #42A5F5, #cf8ef9, #fe9169)"},children:[(0,s.jsx)("div",{className:"mb-2",children:(0,s.jsxs)("h2",{className:"text-sm font-medium text-white text-opacity-90",children:["monthly"===t?"Monthly":"Weekly"," Expenses"]})}),(0,s.jsx)("div",{className:"flex justify-between items-end mb-4",children:(0,s.jsxs)("p",{className:"text-4xl font-bold",children:[h,"monthly"===t?a.toFixed(2):l.toFixed(2)]})}),i&&(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-1",children:[(0,s.jsx)("span",{className:"text-xs font-medium text-white",children:"Budget Progress"}),(0,s.jsxs)("span",{className:"text-xs font-medium text-white",children:[Math.min(100,Math.round(("monthly"===t?a:l)/i*100)),"%"]})]}),(0,s.jsx)("div",{className:"h-2.5 bg-white bg-opacity-20 rounded-full overflow-hidden",children:(0,s.jsx)("div",{className:"h-full rounded-full",style:{width:"".concat(Math.min(100,("monthly"===t?a:l)/i*100),"%"),background:("monthly"===t?a:l)>i?"linear-gradient(90deg, #ff6b6b, #ff8787)":"linear-gradient(90deg, rgba(255,255,255,0.5), rgba(255,255,255,0.7))"}})}),(0,s.jsxs)("div",{className:"flex justify-between text-xs mt-1.5 text-white",children:[(0,s.jsxs)("span",{children:[h,("monthly"===t?a:l).toFixed(0)," spent"]}),(0,s.jsxs)("span",{children:[h,i.toFixed(0)," budget"]})]})]}),(0,s.jsx)("div",{className:"mt-6",children:(0,s.jsx)("div",{className:"h-36",children:(0,s.jsx)(y.Z,{option:c,style:{height:"100%",width:"100%"},opts:{renderer:"canvas"},notMerge:!0,lazyUpdate:!0})})})]})};function j(){(0,l.useRouter)();let{user:e,loading:t}=(0,h.a)(),[a,n]=(0,r.useState)([]),[i,y]=(0,r.useState)(!0),[p,w]=(0,r.useState)(0),[j,v]=(0,r.useState)(0),[N,k]=(0,r.useState)("monthly"),[S,D]=(0,r.useState)(null),[L,F]=(0,r.useState)([]),[E,_]=(0,r.useState)([]),[C,A]=(0,r.useState)(null);return(0,r.useEffect)(()=>{let t=async()=>{if(e)try{y(!0);let[e,t]=await Promise.all([x.Z.getExpenses(),u.Z.getUserData()]);t&&t.budget&&A(t.budget);let a=[...e].sort((e,t)=>new Date(t.timestamp||t.date)-new Date(e.timestamp||e.date));n(a);let s=new Date,r=s.getMonth(),l=s.getFullYear(),o=new Date;o.setDate(o.getDate()-7);let i=e.filter(e=>{let t=new Date(e.timestamp||e.date);return t.getMonth()===r&&t.getFullYear()===l}),c=e.filter(e=>{let t=new Date(e.timestamp||e.date);return t>=o}),d=i.reduce((e,t)=>e+(parseFloat(t.amount)||0),0),h=c.reduce((e,t)=>e+(parseFloat(t.amount)||0),0);w(d),v(h);let m={},f=new Date(l,r+1,0).getDate();for(let e=1;e<=f;e++){let t=e.toString();m[t]={day:t,amount:0}}i.forEach(e=>{let t=new Date(e.timestamp||e.date),a=t.getDate().toString();m[a]&&(m[a].amount+=parseFloat(e.amount)||0)});let g=Object.values(m).sort((e,t)=>parseInt(e.day)-parseInt(t.day));F(g);let p={},b=new Date(s);b.setDate(s.getDate()-s.getDay());let j=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];for(let e=0;e<7;e++){let t=new Date(b);t.setDate(b.getDate()+e),p[e]={day:j[e],date:new Date(t),amount:0}}c.forEach(e=>{let t=new Date(e.timestamp||e.date),a=t.getDay();p[a]&&(p[a].amount+=parseFloat(e.amount)||0)});let N=Object.values(p);_(N),D(null)}catch(e){console.error("Failed to fetch expenses:",e),D("Failed to load expenses")}finally{y(!1)}};t()},[e]),(0,s.jsx)(m.i,{children:(0,s.jsxs)(d.Z,{children:[(0,s.jsx)(o(),{children:(0,s.jsx)("title",{children:"Dashboard | Piggy"})}),(0,s.jsxs)("div",{className:"px-4 py-6 max-w-lg mx-auto",children:[(0,s.jsx)("header",{className:"mb-6",children:(0,s.jsx)("div",{className:"flex justify-between items-start",children:(0,s.jsx)("div",{children:(0,s.jsxs)("h1",{className:"text-2xl font-bold text-gray-800",children:["Welcome ",e&&(e.displayName||e.email),"!"]})})})}),(0,s.jsxs)("div",{className:"flex bg-white rounded-full p-1 shadow-md mb-6 relative overflow-hidden",children:[(0,s.jsx)("button",{onClick:()=>k("monthly"),className:"flex-1 py-2 rounded-full text-sm font-medium transition-all relative z-10 ".concat("monthly"===N?"text-white font-semibold":"text-gray-500 hover:text-gray-700"),style:"monthly"===N?{background:"linear-gradient(135deg, #42A5F5, #cf8ef9, #fe9169)"}:{},children:"Monthly"}),(0,s.jsx)("button",{onClick:()=>k("weekly"),className:"flex-1 py-2 rounded-full text-sm font-medium transition-all relative z-10 ".concat("weekly"===N?"text-white font-semibold":"text-gray-500 hover:text-gray-700"),style:"weekly"===N?{background:"linear-gradient(135deg, #42A5F5, #cf8ef9, #fe9169)"}:{},children:"Weekly"})]}),i?(0,s.jsx)("div",{className:"bg-white rounded-3xl shadow-md p-6 flex justify-center items-center h-64",children:(0,s.jsx)(g.Z,{})}):S?(0,s.jsx)("div",{className:"bg-white rounded-3xl shadow-md p-6 text-center",children:(0,s.jsx)("p",{className:"text-red-500",children:S})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsx)(b,{activeTab:N,monthlyTotal:p,weeklyTotal:j,dailyExpenses:L,weeklyExpenses:E,budget:C}),(0,s.jsxs)("div",{className:"mb-6",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold text-gray-800",children:"Latest Expenses"}),(0,s.jsx)(c(),{href:"/history",legacyBehavior:!0,children:(0,s.jsx)("a",{className:"text-sm font-semibold bg-clip-text text-transparent",style:{backgroundImage:"linear-gradient(45deg, #42A5F5, #cf8ef9, #fe9169)"},children:"View All"})})]}),0===a.length?(0,s.jsx)("div",{className:"text-center py-6 text-gray-500",children:(0,s.jsx)("p",{children:"No expenses found. Add your first expense!"})}):(0,s.jsx)("div",{className:"space-y-3",children:a.slice(0,4).map(e=>{let t=e.area_tags&&e.area_tags.length>0?e.area_tags[0]:"default",a=new Date(e.timestamp||e.date),r=function(e){let t=new Date(e);return t.toLocaleDateString("en-US",{month:"short",day:"numeric"})}(a),l="default";return t&&(l=t.toLowerCase().includes("food")||t.toLowerCase().includes("restaurant")||t.toLowerCase().includes("grocery")?"food":t.toLowerCase().includes("transport")||t.toLowerCase().includes("travel")?"transport":t.toLowerCase().includes("shop")||t.toLowerCase().includes("clothes")?"shopping":t),(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-3 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"w-10 h-10 rounded-full flex items-center justify-center text-sm",children:(0,s.jsx)(f.Z,{iconName:e.main_tag_icon||l,size:20,className:"text-gray-700"})}),(0,s.jsxs)("div",{className:"flex-1 ml-3",children:[(0,s.jsx)("p",{className:"font-medium text-gray-800",children:e.short_text}),(0,s.jsx)("p",{className:"text-xs text-gray-500",children:r})]}),(0,s.jsxs)("p",{className:"font-bold text-gray-800",children:["-$",parseFloat(e.amount).toFixed(2)]})]},e.id||"".concat(e.timestamp,"-").concat(e.amount,"-").concat(Math.random()))})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsx)("div",{children:(0,s.jsx)(c(),{href:"/chat",legacyBehavior:!0,children:(0,s.jsx)("a",{className:"block",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-4 flex flex-col items-center justify-center space-y-2 cursor-pointer",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"linear-gradient(45deg, #42A5F5, #cf8ef9)"},children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 6v6m0 0v6m0-6h6m-6 0H6"})})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"Add Expense"})]})})})},"add-expense"),(0,s.jsx)("div",{children:(0,s.jsx)(c(),{href:"/reports",legacyBehavior:!0,children:(0,s.jsx)("a",{className:"block",children:(0,s.jsxs)("div",{className:"bg-white rounded-2xl shadow-md p-4 flex flex-col items-center justify-center space-y-2 cursor-pointer",children:[(0,s.jsx)("div",{className:"w-12 h-12 rounded-full flex items-center justify-center",style:{background:"linear-gradient(45deg, #cf8ef9, #fe9169)"},children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-6 w-6 text-white",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})}),(0,s.jsx)("span",{className:"text-sm font-medium text-gray-800",children:"Monthly Report"})]})})})},"monthly-report")]})]})]})]})})}},1710:function(e,t,a){"use strict";var s=a(7066),r=a(8346);let l="https://moneymanager-backend-qwbwl7ldoa-oa.a.run.app";console.log("User service using API URL:",l);let n=async()=>{let e=(0,r.v0)(),t=e.currentUser;if(!t)throw Error("User not authenticated");return await t.getIdToken()},o=async()=>{let e=await n();return s.Z.create({baseURL:l,headers:{Authorization:"Bearer ".concat(e),"Content-Type":"application/json"}})};t.Z={async getUserData(){try{let e=await o(),t=await e.get("/api/users/me");return t.data}catch(e){throw console.error("Error fetching user data:",e),e}},async updateUserData(e){try{let t=await o(),a=await t.patch("/api/users/me",e);return a.data}catch(e){throw console.error("Error updating user data:",e),e}}}}},function(e){e.O(0,[976,260,871,219,770,774,888,179],function(){return e(e.s=5732)}),_N_E=e.O()}]);